<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Cross-chain Transaction - XY protocol - Hunter Chang</title><meta content="此系列文章想探討「何謂跨鏈交易」，並用一些產品幫助理解跨鏈交易是如何進行並如何實作。" name="description"/><meta property="og:url" content="https://foodchain.eth.xyz/posts/CrosschainXYProtocol"/><link rel="canonical" href="https://foodchain.eth.xyz/posts/CrosschainXYProtocol"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Hunter Chang - Website"/><meta property="og:description" content="此系列文章想探討「何謂跨鏈交易」，並用一些產品幫助理解跨鏈交易是如何進行並如何實作。"/><meta property="og:title" content="Cross-chain Transaction - XY protocol - Hunter Chang"/><meta property="og:image" content="https:foochain1028.eth.xyzundefined"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@huntarosan"/><meta name="twitter:title" content="Cross-chain Transaction - XY protocol - Hunter Chang"/><meta name="twitter:description" content="此系列文章想探討「何謂跨鏈交易」，並用一些產品幫助理解跨鏈交易是如何進行並如何實作。"/><meta name="twitter:image" content="https:foochain1028.eth.xyzundefined"/><meta property="article:published_time" content="2022-11-19"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/492c4c0cf4c08d7d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/492c4c0cf4c08d7d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-153ca532c98eee0d.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8c286cbce58fc284.js" defer=""></script><script src="/_next/static/chunks/306-faf99b336d274355.js" defer=""></script><script src="/_next/static/chunks/358-59e534127f537b93.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-7d56ef00b8f0fda5.js" defer=""></script><script src="/_next/static/vY_lQkzhgLdIAWH5ygAqn/_buildManifest.js" defer=""></script><script src="/_next/static/vY_lQkzhgLdIAWH5ygAqn/_ssgManifest.js" defer=""></script></head><body class="bg-white dark:bg-black text-gray-900 dark:text-white"><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if(e){c.add(e|| '')}else{c.add('dark');}if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'dark'}catch(t){}}();</script><header><div class="max-w-5xl px-8 mx-auto"><div class="flex items-center justify-between py-6"><nav><a class="text-gray-900 dark:text-yellow-200 pr-6 py-4" href="/">Home</a><a class="text-gray-900 dark:text-yellow-200 px-6 py-4" href="/projects">Projects</a><a class="text-gray-900 dark:text-yellow-200 px-6 py-4" href="/posts">Posts</a></nav></div></div></header><main><div class="max-w-5xl px-8 py-4 mx-auto"><article><h1 class="mb-3 text-gray-900 dark:text-white">Cross-chain Transaction - XY protocol</h1><p class="mb-10 text-sm text-gray-500 dark:text-gray-400">November 19, 2022</p><div class="prose dark:prose-dark"><h2 id="前言"><a class="anchor" href="#前言"><span class="icon icon-link"></span></a>前言</h2>
<p>此系列文章想探討<strong>何謂跨鏈交易</strong>，並用一些產品幫助理解跨鏈交易是如何進行並如何實作。</p>
<h2 id="何謂跨鏈交易、跨鏈橋？為何需要跨鏈？"><a class="anchor" href="#何謂跨鏈交易、跨鏈橋？為何需要跨鏈？"><span class="icon icon-link"></span></a>何謂跨鏈交易、跨鏈橋？為何需要跨鏈？</h2>
<p>區塊鏈的生態系是一個<strong>封閉的世界</strong>，可以把它想像成一個在海洋中的孤島，島上的居民（節點）無法得知來自島外的資訊。</p>
<p>或將區塊鏈的世界想像成我們的地球，每一個區塊鏈都是陸地，但是在區塊鏈們之間間隔著汪洋大海。就與真實世界相同，A 地擁有大量的礦山、石油，B 地擁有良好氣候可以種植糧食，C 地則擁有各種高科技技術，若是<strong>有個交通方式讓這些地區的人們互相合作</strong>，可以創造出一個更好的世界。</p>
<p>若兩條獨立的區塊鏈想要進行溝通（如資產交換），事實上是透過「<strong>資訊的交換</strong>」來達成目的。</p>
<h2 id="如何交換資訊？"><a class="anchor" href="#如何交換資訊？"><span class="icon icon-link"></span></a>如何交換資訊？</h2>
<h3 id="跨鏈橋分類"><a class="anchor" href="#跨鏈橋分類"><span class="icon icon-link"></span></a>跨鏈橋分類</h3>
<p>跨鏈的方式目前常見的可分為四種：</p>
<ol>
<li><strong>Trusted Relayer</strong></li>
<li><strong>HTLC</strong></li>
<li><strong>Optimistic Verification</strong></li>
<li><strong>Light client + Trustless relayers</strong></li>
</ol>
<p>通常在進行跨鏈交易時，需要透過「<strong>信任的中間者</strong>」來進行訊息的傳遞，或透過其他方式驗證訊息的真偽，而跨鏈交易者只能全然相信這個傳遞訊息的人/ 機器人/ 驗證機制。</p>
<blockquote>
<p>3 與 4 的詳情可參考 <a href="https://medium.com/taipei-ethereum-meetup/%E8%B7%A8%E9%8F%88%E6%A9%8B%E6%AF%94%E8%BC%83-4327192f7200">Nic 的文章</a>
此系列文章主要會介紹 <strong>Trusted Relayer</strong> 與 <strong>HTLC</strong> 這兩種交換方式。</p>
</blockquote>
<h2 id="trusted-relayer"><a class="anchor" href="#trusted-relayer"><span class="icon icon-link"></span></a>Trusted Relayer</h2>
<p>Trusted Relayer 指的是<strong>幫助在區塊鏈之間傳遞訊息的中間者</strong>。</p>
<p>本文會以 X swap 作為研究的對象。</p>
<h3 id="x-swap-protocol"><a class="anchor" href="#x-swap-protocol"><span class="icon icon-link"></span></a>X swap protocol</h3>
<p>X swap 是一個由 XY Finance 提供的產品，是一種整合不同鏈上的 DEX 作為跨鏈交換的系統，它可以尋找與在不同鏈上 DEX 的最短交換路徑，節省以往繁多的交換步驟與手續費。</p>
<p><img src="https://i.imgur.com/GmVlo6T.png" alt=""/>
fig. 1 - X Swap display (sited from <a href="https://docs.xy.finance/products/x-swap/how-it-works">XY finance</a>)</p>
<h3 id="swapper-and-consensus"><a class="anchor" href="#swapper-and-consensus"><span class="icon icon-link"></span></a>Swapper and Consensus</h3>
<p>在 X Swap 系統中有兩個角色：</p>
<h4 id="swapper"><a class="anchor" href="#swapper"><span class="icon icon-link"></span></a>Swapper</h4>
<p>是在不同鏈上的 smart contracts，可以想像成一個錢包或是流動池，負責管理與暫存你在跨鏈交易進行時存入的資產。它也會幫助跨鏈交易的 routing，也就是尋找（項目方設計演算法中認為）最佳的跨鏈路徑，藉此尋找較佳的手續費。</p>
<blockquote>
<p>實際上與使用者接觸的只有 Swapper 這個合約（XY 在每個鏈上會部署不同的 Swapper 合約 ），在 Source Chain 的 Swapper 負責收待轉換的幣，Target Chain 的 Swapper 則負責轉交轉換後的幣。</p>
</blockquote>
<p>一個 Swapper 的組成部件如下：
<img src="https://i.imgur.com/rq8FdsX.png" alt=""/></p>
<p>在 Swapper 中會存入很多的穩定幣（如 USDT、USDC），因此在使用者進行交換時，可以省略繁多的轉換過程，而是直接將存入的 ERC-20 或其他種代幣轉換成穩定幣。</p>
<p>使用穩定幣作為中介資產（intermediate asset）的優點有幾項：</p>
<ol>
<li>可以快速並穩定地透過穩定幣轉換。</li>
<li>容易達成流動性。</li>
<li>避免若 Swapper 存入各種資產後，可能發生資產的價格波動或是流動性割裂等狀況。</li>
</ol>
<h4 id="consensus-validator-set"><a class="anchor" href="#consensus-validator-set"><span class="icon icon-link"></span></a>Consensus (Validator Set)</h4>
<p>由許多來自不同組織的節點構成，負責驗證跨鏈流程中不受其他惡意節點控制。Consensus 會接受來自 source 的 Swapper 資訊（使用者的 request），並呼叫 target chain 的 Swapper 上的函式，最後再呼叫 source 中的函式完成跨鏈交易。</p>
<blockquote>
<p>在鏈上無法直接透過合約來呼叫合約，因此需要「有人」（EOA）來戳放在各個鏈上的合約，才能達到跨鏈訊息交換的目的。</p>
</blockquote>
<p>Consensus 可以分成兩個部分：</p>
<ul>
<li>Executor:<!-- -->
<ul>
<li>負責 listen Source 端呼叫 <code>swap()</code> 時產生的 event，得到轉換的資訊。</li>
<li>負責執行在 Target Swapper 的函式。</li>
<li>在驗證交易成功後（由 Validator 負責）將收到簽章，藉此收取在 Swapper 上儲存的資產。</li>
</ul>
</li>
<li>Validator:<!-- -->
<ul>
<li>負責驗證 Executor 在 Target Swapper 執行的結果是否符合要求（例如使用者收到的最低資產數量）</li>
<li>驗證成功後會發布一筆簽章給予 Executor，當作 Executor 的交易結果也可讓 Executor 取得在 Swapper 中的資產。</li>
</ul>
</li>
</ul>
<p><img src="https://i.imgur.com/ajGXANY.png" alt=""/></p>
<h3 id="a-example-of-x-swap"><a class="anchor" href="#a-example-of-x-swap"><span class="icon icon-link"></span></a>A Example of X Swap</h3>
<p>以 fig. 1 為例，Bob 現在錢包中有 1 枚在以太鏈中產生的 wBTC（wrapped BTC），他想要透過 X swap 交換在 BSC 上的 BNB。下述的號碼會對應到 fig.1 箭頭上的號碼。</p>
<p>(1): Bob 透過 X swap 的前端輸入想要跨鏈交換的資產與大小，前端與 Swapper 會透過演算法去計算最佳轉換路徑，並收到 X Swap 的報價（3000 BNB，並接受 1% 的 slippage tolerance）。</p>
<p>(1): 若 Bob 接受此報價，便傳送一個 request 給予 Swapper（也就是 transfer 1 wBTC 給 Swapper）。</p>
<p>(2): Swapper 將此 1 wBTC 在 Source Chain 上的 DEX 轉換成 30000 USDT。</p>
<p>(3): 運行中的節點（Consensus）會偵測到此 request，並尋找成功兌換的機會。找到後便會送出一個 request 給 Target Chain Swapper，希望 Swapper 透過在 Target Chain 上的 DEX，將 30000 USDT （原本就存在 Swapper 身上的 USDT）轉換成 BNB，並儲存於 Swapper 上。</p>
<p>(4)、(5): Swapper 與 Target Chain 上的 DEX 執行交換的動作。在第一步有提到 slippage tolerance (ST)，指的是當 slippage 超過 ST 時，將會導致 swap 失敗，此時會將在 Target Chain 上的穩定幣直接轉給使用者，讓使用者再使用其他方式交換。</p>
<p>因此此步可能發生兩種情形：</p>
<ul>
<li>slippage 太高（得到的 BNB &lt; 2970）：Swapper 將 30000 USDT 扣除手續費後轉到 Bob 在 BSC 上的地址。</li>
<li>slippage 可接受（BNB &gt; 2970）：將扣去手續費的資金轉換成 BNB，並將這筆 BNB 轉到 Bob 在 BSC 上的地址。</li>
</ul>
<p>(6)、(7): 最後 XY Protocol 會在從 Source 端的 Swapper 取得 30000 USDT，完成整個跨鏈資產的轉換。</p>
<h3 id="smart-contract-of-swapper"><a class="anchor" href="#smart-contract-of-swapper"><span class="icon icon-link"></span></a>Smart Contract of Swapper</h3>
<p>以下會以 X Swap 的<a href="https://github.com/XY-Finance/xy-protocol/blob/master/contracts/Swapper.sol">智能合約</a>，了解在 protocol 中是如何實現跨鏈交易的。</p>
<h4 id="safeerc20"><a class="anchor" href="#safeerc20"><span class="icon icon-link"></span></a>safeERC20</h4>
<p>引用 Openzeppelin (OZ) 的 <code>SafeERC20.sol</code> 合約，其中的函式都是 safe 版的函式，像是<code>safeTransfer()</code>、<code>safeTransferFrom()</code> 等函式，在 <code>Swapper.sol</code> 中呼叫時可使用 <code>using SafeERC20 for IERC20</code>，如此便可以透過 <code>token.safeTransfer()</code> 來呼叫函式。</p>
<h4 id="swapinfo"><a class="anchor" href="#swapinfo"><span class="icon icon-link"></span></a>SwapInfo</h4>
<p>合約中用 Struct 將跨鏈交換的資訊包裝起來，在 swap 的時候直接將整個 Struct 傳入即可。</p>
<pre class="language-solidity"><code class="language-solidity code-highlight"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">SwapInfo</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token builtin">uint8</span> chainId<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token builtin">address</span> dex<span class="token punctuation">;</span>
</span><span class="code-line">    IERC20 fromToken<span class="token punctuation">;</span>
</span><span class="code-line">    IERC20 toToken<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token builtin">bytes</span> swapData<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<ul>
<li>chainId: 在哪條鏈上進行。</li>
<li>dex: swap 進行時要轉交資產的地址。</li>
<li>fromToken: 準備要被轉換的資產。</li>
<li>toToken: 準備要轉換成的資產。</li>
<li>swapData: 要傳送給 dex 的資訊。</li>
</ul>
<h4 id="oneinch-dex--anyswap"><a class="anchor" href="#oneinch-dex--anyswap"><span class="icon icon-link"></span></a>OneInch DEX &amp; Anyswap</h4>
<p>Swapper 使用 OneInch 作為預設的 DEX，並透過 Anyswap V3 作為跨鏈上使用的媒介。</p>
<h4 id="流程"><a class="anchor" href="#流程"><span class="icon icon-link"></span></a>流程</h4>
<p>整個跨鏈交換的流程如下：</p>
<ol>
<li>user</li>
<li>swapper</li>
<li>proxy address</li>
<li>bridge deposit address</li>
<li>target chain swapper</li>
<li>target chain user address</li>
</ol>
<h4 id="swap"><a class="anchor" href="#swap"><span class="icon icon-link"></span></a>swap()</h4>
<p><code>swap()</code> 的功能是將資產交給 Swapper 保管，</p>
<pre class="language-solidity"><code class="language-solidity code-highlight"><span class="code-line"><span class="token keyword">function</span> <span class="token function">swap</span><span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token builtin">uint256</span> fromTokenAmount<span class="token punctuation">,</span>
</span><span class="code-line">    SwapInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> swapInfos<span class="token punctuation">,</span>
</span><span class="code-line">    SwapInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> targetChainSwapInfo<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token builtin">address</span> receiver
</span><span class="code-line"><span class="token punctuation">)</span>
</span></code></pre>
<p>將資產交給 Swapper：</p>
<pre class="language-solidity"><code class="language-solidity code-highlight"><span class="code-line"><span class="token comment">//... 省略</span>
</span><span class="code-line"><span class="token builtin">uint256</span> _fromTokenBalance <span class="token operator">=</span> <span class="token function">getTokenBalance</span><span class="token punctuation">(</span>fromToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">fromToken<span class="token punctuation">.</span><span class="token function">safeTransferFrom</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fromTokenAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">getTokenBalance</span><span class="token punctuation">(</span>fromToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>_fromTokenBalance<span class="token punctuation">)</span> <span class="token operator">==</span> fromTokenAmount<span class="token punctuation">,</span> <span class="token string">&quot;ERR_INVALID_AMOUNT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">//...省略</span>
</span></code></pre>
<p>隨後判斷 DEX 為何，像下方測試便是用 Uniswap V2 交換 ERC-20，再利用 Y Pool 去做跨鏈交換的動作，最後在 BSC 上以 BSC DODO V2 轉換成 BNB。</p>
<blockquote>
<p>Y Pool 是 XY Finance 提供的另一項產品，流動性提供者（Liquility Povider, LP）將資產投入，為流動池提供流動性（liquility），換取 XY Token。Y Pool 其中一部分的資產會作為 Swapper 的資金來源，而 LP 也可以透過抽取手續費獲得獎勵。</p>
</blockquote>
<pre class="language-solidity"><code class="language-solidity code-highlight"><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dex <span class="token operator">==</span> oneInchAggregator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">approveToken</span><span class="token punctuation">(</span>fromToken<span class="token punctuation">,</span> oneInchAggregator<span class="token punctuation">,</span> fromTokenAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token builtin">uint256</span> toTokenAmount <span class="token operator">=</span> <span class="token function">getTokenBalance</span><span class="token punctuation">(</span>toToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> oneInchAggregator<span class="token punctuation">.</span>call<span class="token punctuation">{</span>value<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">(</span>swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>swapData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;ERR_DEX_SWAP_FAILED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    fromTokenAmount <span class="token operator">=</span> <span class="token function">getTokenBalance</span><span class="token punctuation">(</span>toToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>toTokenAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>proxies<span class="token punctuation">[</span>swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dex<span class="token punctuation">]</span> <span class="token operator">||</span> swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dex <span class="token operator">==</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">safeTransferAsset</span><span class="token punctuation">(</span>swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dex<span class="token punctuation">,</span> fromToken<span class="token punctuation">,</span> fromTokenAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dex <span class="token operator">==</span> anyswapRouter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">require</span><span class="token punctuation">(</span>targetChainSwapInfo<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;ERR_TARGET_CHAIN_SWAP_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">approveToken</span><span class="token punctuation">(</span>fromToken<span class="token punctuation">,</span> anyswapRouter<span class="token punctuation">,</span> fromTokenAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">IAnyswapV3Router</span><span class="token punctuation">(</span>anyswapRouter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anySwapOutUnderlying</span><span class="token punctuation">(</span>anyTokenMapping<span class="token punctuation">[</span><span class="token builtin">address</span><span class="token punctuation">(</span>fromToken<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fromTokenAmount<span class="token punctuation">,</span> targetChainSwapInfo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>chainId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">else</span> <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">&quot;ERR_INVALID_DEX&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">emit</span> <span class="token function">SourceChainSwap</span><span class="token punctuation">(</span>swapId<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>chainId<span class="token punctuation">,</span> swapInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fromTokenAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>以下是測試 1 ETH 轉換成 BNB 的結果。
<img src="https://i.imgur.com/d9NQHMH.png" alt=""/></p>
<h2 id="結語"><a class="anchor" href="#結語"><span class="icon icon-link"></span></a>結語</h2>
<p>在看過程式後，發現在 XY Finance git 中的 repo 似乎沒有關於 Consensus 方面的 code，不確定是我漏看了還是因為商業關係而沒有開源（若有錯誤請大方通知我，非常感謝！）。當然這部分不開源也十分合理，只是我十分好奇其中的機制與寫法。</p>
<p>就以 Consensus （鏈與鏈之間之傳訊者）並不透明作為背景下，使用者只能完全信任項目方開發的程式不會出錯或是有不法份子涉入，跨鏈交換就會變得十分不安全且充滿風險。但在 Swapper 中也有用到 Anyswap Router 作為跨鏈交換的機制，因此可能並不完全是依靠第三方節點來做資訊交換。</p>
<p>上述提到的不透明化（中心化）並不等同於完全危險，它也帶來一定程度的使用者體驗（像是可以快速的跨鏈轉換、或是減少使用者在使用產品時需得到的資訊量）；而去中心化也不一定完全安全，可能存在 smart contract bug 導致駭客竊取資產的情況。</p>
<p>我認為身處 Web3 的使用者，應該要有如 Vitalik 所言「監管自己財產（self-custody）」的能力。我將其理解成用心看待自己的資產，用心了解每項產品背後可能存在的風險，並相信技術帶來的便利。</p>
<h2 id="ref"><a class="anchor" href="#ref"><span class="icon icon-link"></span></a>Ref:</h2>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10289212">跨鏈橋技術詳解</a></li>
<li><a href="https://ethereum.org/en/bridges/">Blockchain bridges</a></li>
<li><a href="https://www.alchemy.com/overviews/cross-chain-bridges">What are Cross-Chain Bridges?</a></li>
<li><a href="https://docs.xy.finance">XY Finance Documentation</a></li>
<li><a href="https://medium.com/taipei-ethereum-meetup/%E8%B7%A8%E9%8F%88%E6%A9%8B%E6%AF%94%E8%BC%83-4327192f7200">跨鏈橋比較</a></li>
</ul></div></article></div></main><footer class="py-8 flex justify-center items-center"><div class="max-w-5xl px-8 mx-auto"><i> <!-- -->Shout out to author of this template -<!-- --> <a class="text-gray-900 dark:text-white" href="https://twitter.com/hunterhchang">Hunter Chang</a></i></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h2: \"h2\",\n    a: \"a\",\n    span: \"span\",\n    p: \"p\",\n    strong: \"strong\",\n    h3: \"h3\",\n    ol: \"ol\",\n    li: \"li\",\n    blockquote: \"blockquote\",\n    img: \"img\",\n    h4: \"h4\",\n    ul: \"ul\",\n    code: \"code\",\n    pre: \"pre\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.h2, {\n      id: \"前言\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#前言\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"前言\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"此系列文章想探討\", _jsx(_components.strong, {\n        children: \"何謂跨鏈交易\"\n      }), \"，並用一些產品幫助理解跨鏈交易是如何進行並如何實作。\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"何謂跨鏈交易、跨鏈橋？為何需要跨鏈？\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#何謂跨鏈交易、跨鏈橋？為何需要跨鏈？\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"何謂跨鏈交易、跨鏈橋？為何需要跨鏈？\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"區塊鏈的生態系是一個\", _jsx(_components.strong, {\n        children: \"封閉的世界\"\n      }), \"，可以把它想像成一個在海洋中的孤島，島上的居民（節點）無法得知來自島外的資訊。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"或將區塊鏈的世界想像成我們的地球，每一個區塊鏈都是陸地，但是在區塊鏈們之間間隔著汪洋大海。就與真實世界相同，A 地擁有大量的礦山、石油，B 地擁有良好氣候可以種植糧食，C 地則擁有各種高科技技術，若是\", _jsx(_components.strong, {\n        children: \"有個交通方式讓這些地區的人們互相合作\"\n      }), \"，可以創造出一個更好的世界。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"若兩條獨立的區塊鏈想要進行溝通（如資產交換），事實上是透過「\", _jsx(_components.strong, {\n        children: \"資訊的交換\"\n      }), \"」來達成目的。\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"如何交換資訊？\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#如何交換資訊？\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"如何交換資訊？\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      id: \"跨鏈橋分類\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#跨鏈橋分類\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"跨鏈橋分類\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"跨鏈的方式目前常見的可分為四種：\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.strong, {\n          children: \"Trusted Relayer\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.strong, {\n          children: \"HTLC\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.strong, {\n          children: \"Optimistic Verification\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.strong, {\n          children: \"Light client + Trustless relayers\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"通常在進行跨鏈交易時，需要透過「\", _jsx(_components.strong, {\n        children: \"信任的中間者\"\n      }), \"」來進行訊息的傳遞，或透過其他方式驗證訊息的真偽，而跨鏈交易者只能全然相信這個傳遞訊息的人/ 機器人/ 驗證機制。\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"3 與 4 的詳情可參考 \", _jsx(_components.a, {\n          href: \"https://medium.com/taipei-ethereum-meetup/%E8%B7%A8%E9%8F%88%E6%A9%8B%E6%AF%94%E8%BC%83-4327192f7200\",\n          children: \"Nic 的文章\"\n        }), \"\\n此系列文章主要會介紹 \", _jsx(_components.strong, {\n          children: \"Trusted Relayer\"\n        }), \" 與 \", _jsx(_components.strong, {\n          children: \"HTLC\"\n        }), \" 這兩種交換方式。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"trusted-relayer\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#trusted-relayer\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Trusted Relayer\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Trusted Relayer 指的是\", _jsx(_components.strong, {\n        children: \"幫助在區塊鏈之間傳遞訊息的中間者\"\n      }), \"。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"本文會以 X swap 作為研究的對象。\"\n    }), \"\\n\", _jsxs(_components.h3, {\n      id: \"x-swap-protocol\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#x-swap-protocol\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"X swap protocol\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"X swap 是一個由 XY Finance 提供的產品，是一種整合不同鏈上的 DEX 作為跨鏈交換的系統，它可以尋找與在不同鏈上 DEX 的最短交換路徑，節省以往繁多的交換步驟與手續費。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.img, {\n        src: \"https://i.imgur.com/GmVlo6T.png\",\n        alt: \"\"\n      }), \"\\nfig. 1 - X Swap display (sited from \", _jsx(_components.a, {\n        href: \"https://docs.xy.finance/products/x-swap/how-it-works\",\n        children: \"XY finance\"\n      }), \")\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      id: \"swapper-and-consensus\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#swapper-and-consensus\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Swapper and Consensus\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"在 X Swap 系統中有兩個角色：\"\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"swapper\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#swapper\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Swapper\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"是在不同鏈上的 smart contracts，可以想像成一個錢包或是流動池，負責管理與暫存你在跨鏈交易進行時存入的資產。它也會幫助跨鏈交易的 routing，也就是尋找（項目方設計演算法中認為）最佳的跨鏈路徑，藉此尋找較佳的手續費。\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"實際上與使用者接觸的只有 Swapper 這個合約（XY 在每個鏈上會部署不同的 Swapper 合約 ），在 Source Chain 的 Swapper 負責收待轉換的幣，Target Chain 的 Swapper 則負責轉交轉換後的幣。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"一個 Swapper 的組成部件如下：\\n\", _jsx(_components.img, {\n        src: \"https://i.imgur.com/rq8FdsX.png\",\n        alt: \"\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"在 Swapper 中會存入很多的穩定幣（如 USDT、USDC），因此在使用者進行交換時，可以省略繁多的轉換過程，而是直接將存入的 ERC-20 或其他種代幣轉換成穩定幣。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"使用穩定幣作為中介資產（intermediate asset）的優點有幾項：\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"可以快速並穩定地透過穩定幣轉換。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"容易達成流動性。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"避免若 Swapper 存入各種資產後，可能發生資產的價格波動或是流動性割裂等狀況。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"consensus-validator-set\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#consensus-validator-set\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Consensus (Validator Set)\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"由許多來自不同組織的節點構成，負責驗證跨鏈流程中不受其他惡意節點控制。Consensus 會接受來自 source 的 Swapper 資訊（使用者的 request），並呼叫 target chain 的 Swapper 上的函式，最後再呼叫 source 中的函式完成跨鏈交易。\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"在鏈上無法直接透過合約來呼叫合約，因此需要「有人」（EOA）來戳放在各個鏈上的合約，才能達到跨鏈訊息交換的目的。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Consensus 可以分成兩個部分：\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Executor:\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"負責 listen Source 端呼叫 \", _jsx(_components.code, {\n              children: \"swap()\"\n            }), \" 時產生的 event，得到轉換的資訊。\"]\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"負責執行在 Target Swapper 的函式。\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"在驗證交易成功後（由 Validator 負責）將收到簽章，藉此收取在 Swapper 上儲存的資產。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Validator:\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"負責驗證 Executor 在 Target Swapper 執行的結果是否符合要求（例如使用者收到的最低資產數量）\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"驗證成功後會發布一筆簽章給予 Executor，當作 Executor 的交易結果也可讓 Executor 取得在 Swapper 中的資產。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"https://i.imgur.com/ajGXANY.png\",\n        alt: \"\"\n      })\n    }), \"\\n\", _jsxs(_components.h3, {\n      id: \"a-example-of-x-swap\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#a-example-of-x-swap\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"A Example of X Swap\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"以 fig. 1 為例，Bob 現在錢包中有 1 枚在以太鏈中產生的 wBTC（wrapped BTC），他想要透過 X swap 交換在 BSC 上的 BNB。下述的號碼會對應到 fig.1 箭頭上的號碼。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(1): Bob 透過 X swap 的前端輸入想要跨鏈交換的資產與大小，前端與 Swapper 會透過演算法去計算最佳轉換路徑，並收到 X Swap 的報價（3000 BNB，並接受 1% 的 slippage tolerance）。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(1): 若 Bob 接受此報價，便傳送一個 request 給予 Swapper（也就是 transfer 1 wBTC 給 Swapper）。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(2): Swapper 將此 1 wBTC 在 Source Chain 上的 DEX 轉換成 30000 USDT。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(3): 運行中的節點（Consensus）會偵測到此 request，並尋找成功兌換的機會。找到後便會送出一個 request 給 Target Chain Swapper，希望 Swapper 透過在 Target Chain 上的 DEX，將 30000 USDT （原本就存在 Swapper 身上的 USDT）轉換成 BNB，並儲存於 Swapper 上。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(4)、(5): Swapper 與 Target Chain 上的 DEX 執行交換的動作。在第一步有提到 slippage tolerance (ST)，指的是當 slippage 超過 ST 時，將會導致 swap 失敗，此時會將在 Target Chain 上的穩定幣直接轉給使用者，讓使用者再使用其他方式交換。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"因此此步可能發生兩種情形：\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"slippage 太高（得到的 BNB \u003c 2970）：Swapper 將 30000 USDT 扣除手續費後轉到 Bob 在 BSC 上的地址。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"slippage 可接受（BNB \u003e 2970）：將扣去手續費的資金轉換成 BNB，並將這筆 BNB 轉到 Bob 在 BSC 上的地址。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(6)、(7): 最後 XY Protocol 會在從 Source 端的 Swapper 取得 30000 USDT，完成整個跨鏈資產的轉換。\"\n    }), \"\\n\", _jsxs(_components.h3, {\n      id: \"smart-contract-of-swapper\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#smart-contract-of-swapper\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Smart Contract of Swapper\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"以下會以 X Swap 的\", _jsx(_components.a, {\n        href: \"https://github.com/XY-Finance/xy-protocol/blob/master/contracts/Swapper.sol\",\n        children: \"智能合約\"\n      }), \"，了解在 protocol 中是如何實現跨鏈交易的。\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"safeerc20\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#safeerc20\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"safeERC20\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"引用 Openzeppelin (OZ) 的 \", _jsx(_components.code, {\n        children: \"SafeERC20.sol\"\n      }), \" 合約，其中的函式都是 safe 版的函式，像是\", _jsx(_components.code, {\n        children: \"safeTransfer()\"\n      }), \"、\", _jsx(_components.code, {\n        children: \"safeTransferFrom()\"\n      }), \" 等函式，在 \", _jsx(_components.code, {\n        children: \"Swapper.sol\"\n      }), \" 中呼叫時可使用 \", _jsx(_components.code, {\n        children: \"using SafeERC20 for IERC20\"\n      }), \"，如此便可以透過 \", _jsx(_components.code, {\n        children: \"token.safeTransfer()\"\n      }), \" 來呼叫函式。\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"swapinfo\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#swapinfo\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"SwapInfo\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"合約中用 Struct 將跨鏈交換的資訊包裝起來，在 swap 的時候直接將整個 Struct 傳入即可。\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-solidity\",\n      children: _jsxs(_components.code, {\n        className: \"language-solidity code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"struct\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"SwapInfo\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"uint8\"\n          }), \" chainId\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"address\"\n          }), \" dex\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    IERC20 fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    IERC20 toToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"bytes\"\n          }), \" swapData\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"chainId: 在哪條鏈上進行。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"dex: swap 進行時要轉交資產的地址。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"fromToken: 準備要被轉換的資產。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"toToken: 準備要轉換成的資產。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"swapData: 要傳送給 dex 的資訊。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"oneinch-dex--anyswap\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#oneinch-dex--anyswap\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"OneInch DEX \u0026 Anyswap\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Swapper 使用 OneInch 作為預設的 DEX，並透過 Anyswap V3 作為跨鏈上使用的媒介。\"\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"流程\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#流程\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"流程\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"整個跨鏈交換的流程如下：\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"user\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"swapper\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"proxy address\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"bridge deposit address\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"target chain swapper\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"target chain user address\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"swap\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#swap\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"swap()\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"swap()\"\n      }), \" 的功能是將資產交給 Swapper 保管，\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-solidity\",\n      children: _jsxs(_components.code, {\n        className: \"language-solidity code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"swap\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"uint256\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    SwapInfo\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"calldata\"\n          }), \" swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    SwapInfo\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"calldata\"\n          }), \" targetChainSwapInfo\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"address\"\n          }), \" receiver\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"將資產交給 Swapper：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-solidity\",\n      children: _jsxs(_components.code, {\n        className: \"language-solidity code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"//... 省略\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"uint256\"\n          }), \" _fromTokenBalance \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getTokenBalance\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"safeTransferFrom\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"msg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"sender\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"address\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"require\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getTokenBalance\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"sub\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"_fromTokenBalance\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"==\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"ERR_INVALID_AMOUNT\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"//...省略\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"隨後判斷 DEX 為何，像下方測試便是用 Uniswap V2 交換 ERC-20，再利用 Y Pool 去做跨鏈交換的動作，最後在 BSC 上以 BSC DODO V2 轉換成 BNB。\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"Y Pool 是 XY Finance 提供的另一項產品，流動性提供者（Liquility Povider, LP）將資產投入，為流動池提供流動性（liquility），換取 XY Token。Y Pool 其中一部分的資產會作為 Swapper 的資金來源，而 LP 也可以透過抽取手續費獲得獎勵。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-solidity\",\n      children: _jsxs(_components.code, {\n        className: \"language-solidity code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"dex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"==\"\n          }), \" oneInchAggregator\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"approveToken\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" oneInchAggregator\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"uint256\"\n          }), \" toTokenAmount \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getTokenBalance\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"toToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"bool\"\n          }), \" success\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" oneInchAggregator\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"call\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"value\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \" msg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"value\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"swapData\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"require\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"success\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"ERR_DEX_SWAP_FAILED\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    fromTokenAmount \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getTokenBalance\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"toToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"sub\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"toTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"proxies\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"dex\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"dex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"==\"\n          }), \" receiver\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"safeTransferAsset\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"dex\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"dex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"==\"\n          }), \" anyswapRouter\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"require\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"targetChainSwapInfo\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"length \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"ERR_TARGET_CHAIN_SWAP_INFO\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"approveToken\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" anyswapRouter\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"IAnyswapV3Router\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"anyswapRouter\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"anySwapOutUnderlying\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"anyTokenMapping\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"address\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"fromToken\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"address\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" targetChainSwapInfo\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"chainId\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"revert\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"ERR_INVALID_DEX\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"emit\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"SourceChainSwap\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"swapId\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" msg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"sender\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"chainId\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" swapInfos\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" fromTokenAmount\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"以下是測試 1 ETH 轉換成 BNB 的結果。\\n\", _jsx(_components.img, {\n        src: \"https://i.imgur.com/d9NQHMH.png\",\n        alt: \"\"\n      })]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"結語\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#結語\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"結語\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"在看過程式後，發現在 XY Finance git 中的 repo 似乎沒有關於 Consensus 方面的 code，不確定是我漏看了還是因為商業關係而沒有開源（若有錯誤請大方通知我，非常感謝！）。當然這部分不開源也十分合理，只是我十分好奇其中的機制與寫法。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"就以 Consensus （鏈與鏈之間之傳訊者）並不透明作為背景下，使用者只能完全信任項目方開發的程式不會出錯或是有不法份子涉入，跨鏈交換就會變得十分不安全且充滿風險。但在 Swapper 中也有用到 Anyswap Router 作為跨鏈交換的機制，因此可能並不完全是依靠第三方節點來做資訊交換。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"上述提到的不透明化（中心化）並不等同於完全危險，它也帶來一定程度的使用者體驗（像是可以快速的跨鏈轉換、或是減少使用者在使用產品時需得到的資訊量）；而去中心化也不一定完全安全，可能存在 smart contract bug 導致駭客竊取資產的情況。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"我認為身處 Web3 的使用者，應該要有如 Vitalik 所言「監管自己財產（self-custody）」的能力。我將其理解成用心看待自己的資產，用心了解每項產品背後可能存在的風險，並相信技術帶來的便利。\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"ref\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#ref\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Ref:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://ithelp.ithome.com.tw/articles/10289212\",\n          children: \"跨鏈橋技術詳解\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://ethereum.org/en/bridges/\",\n          children: \"Blockchain bridges\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://www.alchemy.com/overviews/cross-chain-bridges\",\n          children: \"What are Cross-Chain Bridges?\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://docs.xy.finance\",\n          children: \"XY Finance Documentation\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://medium.com/taipei-ethereum-meetup/%E8%B7%A8%E9%8F%88%E6%A9%8B%E6%AF%94%E8%BC%83-4327192f7200\",\n          children: \"跨鏈橋比較\"\n        })\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{"title":"Cross-chain Transaction - XY protocol","description":"此系列文章想探討「何謂跨鏈交易」，並用一些產品幫助理解跨鏈交易是如何進行並如何實作。","date":"2022-11-19"}},"frontMatter":{"title":"Cross-chain Transaction - XY protocol","description":"此系列文章想探討「何謂跨鏈交易」，並用一些產品幫助理解跨鏈交易是如何進行並如何實作。","date":"2022-11-19"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"CrosschainXYProtocol"},"buildId":"vY_lQkzhgLdIAWH5ygAqn","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>